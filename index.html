<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Safe Trade Hub â€“ Home</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  
  <!-- Firebase Configuration -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBK-1VZZImDnjmRCXBEzyLAq6AthTZ8yIs",
      authDomain: "safe-trade-hub-a57cb.firebaseapp.com",
      projectId: "safe-trade-hub-a57cb",
      storageBucket: "safe-trade-hub-a57cb.appspot.com",
      messagingSenderId: "509522351934",
      appId: "1:509522351934:web:a9f5624cded8f7a6d93e6f",
      measurementId: "G-060FYYP5DD"
    };
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
  </script>
  
  <!-- Load authentication system -->
  <script src="js/auth-manager.js"></script>
  <script src="js/header-manager.js"></script>

</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <a href="#" class="logo" aria-label="Safe Trade Hub Home">SafeTradeHub</a>
      <nav class="header-actions" aria-label="Top actions">
       <!-- Chat -->
<button class="icon-btn" aria-label="Chat" title="Chat" onclick="toggleChat()">
  <svg viewBox="0 0 24 24" aria-hidden="true">
    <path d="M4 4h16a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H9l-5 5v-5H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/>
  </svg>
</button>

<!-- Chatbot Container (Hidden by Default) -->
<div id="chatbot-container" class="chatbot-container">
  <!-- Embed the chatbot via iframe -->
  <iframe src="https://safetradehub-d797d24354d2.herokuapp.com/chatbot" frameborder="0" width="100%" height="100%" style="border-radius: 26px;"></iframe>
</div>

<!-- Bell -->
<button class="icon-btn" aria-label="Notifications" title="Notifications" onclick="requestNotificationPermission()">
<svg viewBox="0 0 24 24" aria-hidden="true">
<path d="M18 8a6 6 0 10-12 0c0 7-3 8-3 8h18s-3-1-3-8"/>
<path d="M13.73 21a2 2 0 01-3.46 0"/>
</svg>
</button>

        <!-- Navigation will be updated by HeaderManager -->
      </nav>
    </div>
  </header>

  <!-- Hero / Search -->
  <section class="hero">
    <div class="container hero-inner">
      <h1>Find Your Best Product</h1>

      <form class="search" role="search" aria-label="Site search">
        <input type="search" placeholder="Try â€œMobile Accessoriesâ€" aria-label="Search products" />
        <button type="submit" class="btn search-btn" aria-label="Search">
          <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/></svg>
        </button>
      </form>
    </div>
  </section>

  <!-- Categories -->
  <section class="section">
    <div class="container">
      <ul class="categories" aria-label="Browse categories">
        <!-- Row 1 -->
        <li class="cat">
          <span class="cat-icon" aria-hidden="true">
            <img src="images/mobile.avif" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Mobile</span>
          <span class="cat-sub">Mobile</span>
        </li>
        <li class="cat">
          <span class="cat-icon">
            <img src="images/camera.jpg" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Camera</span>
          <span class="cat-sub">Electronics</span>
        </li>
        <li class="cat">
          <span class="cat-icon">
            <img src="images/service.png" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Service</span>
          <span class="cat-sub">Services</span>
        </li>
        <li class="cat">
          <span class="cat-icon">
            <img src="images/chair.webp" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Chair</span>
          <span class="cat-sub">Furniture</span>
        </li>
        <li class="cat">
          <span class="cat-icon">
            <img src="images/dress.jpg" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Dress</span>
          <span class="cat-sub">Fashion</span>
        </li>
        <li class="cat">
          <span class="cat-icon">
            <img src="images/makeup.jpeg" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Makeup</span>
          <span class="cat-sub">Beauty</span>
        </li>
        <!-- Row 2 -->
        <li class="cat">
          <span class="cat-icon">
            <img src="images/book.jpg" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Book</span>
          <span class="cat-sub">Book</span>
        </li>
        <li class="cat">
          <span class="cat-icon">
            <img src="images/bat.jpg" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Bat</span>
          <span class="cat-sub">Sports</span>
        </li>
        <li class="cat">
          <span class="cat-icon">
            <img src="images/dumbell.webp" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Dumbbell</span>
          <span class="cat-sub">Gym</span>
        </li>
        <li class="cat">
          <span class="cat-icon">
            <img src="images/pet.jpg" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Pet Care</span>
          <span class="cat-sub">Animal & Pets</span>
        </li>
        <li class="cat">
          <span class="cat-icon">
            <img src="images/laptop.jpg" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Laptop</span>
          <span class="cat-sub">Computers</span>
        </li>
        <li class="cat">
          <span class="cat-icon">
            <img src="images/homeappliances.jpg" alt="" loading="lazy" />
          </span>
          <span class="cat-title">Appliance</span>
          <span class="cat-sub">Home</span>
        </li>
      </ul>
    </div>
  </section>

  <!-- Recommended -->
  <section class="section">
    <div class="container recs-header">
      <h2>Recommended Products &amp; Services</h2>
      <div class="recs-ctrl">
        <button class="icon-btn arrow" id="recsNext" aria-label="View more">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 4l8 8-8 8"/></svg>
        </button>
      </div>
    </div>

    <div class="container">
      <div class="recs" id="recs">
        <!-- 8 sample cards -->
        <article class="card">
  <div class="card-img">
    <img src="images/iphone12.jpg" alt="Mobile phone" loading="lazy">
  </div>
  <h3 class="card-title">IPhone 12 Pro Max</h3>
  <button class="btn" 
          data-add-to-cart
          data-id="sku-iphone12"
          data-name="IPhone 12 Pro Max"
          data-price="899.00"
          data-img="images/iphone12.jpg"
          style="width:100%; margin-top:8px;">Add to Cart</button>
</article>

<article class="card">
  <div class="card-img">
    <img src="images/bookset.jpg" alt="Book" loading="lazy">
  </div>
  <h3 class="card-title">Book Set Of 8</h3>
  <button class="btn" 
          data-add-to-cart
          data-id="sku-bookset8"
          data-name="Book Set Of 8"
          data-price="49.00"
          data-img="images/bookset.jpg"
          style="width:100%; margin-top:8px;">Add to Cart</button>
</article>

<article class="card">
  <div class="card-img">
    <img src="images/oven.jpg" alt="Oven" loading="lazy">
  </div>
  <h3 class="card-title">Dawlance Oven</h3>
  <button class="btn" 
          data-add-to-cart
          data-id="sku-oven-dawlance"
          data-name="Dawlance Oven"
          data-price="179.00"
          data-img="images/oven.jpg"
          style="width:100%; margin-top:8px;">Add to Cart</button>
</article>


      </div>
    </div>
  </section>

  <!-- Trade Pro Features -->
  <section class="section">
    <div class="container">
      <div class="features">
        <h3>Trade Pro : Subscribe To Pro</h3>
        <ul>
          <li>Escrow Payments</li>
          <li>Fast Delivery</li>
          <li>Verified Badge</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Why Choose Us -->
<section class="section">
    <div class="container">
      <h2 class="center">WHY CHOOSE US</h2>
      <div class="why">
        <div class="why-item">
          <div class="why-logo">
            <img src="images/securepayment.png" alt="Safe Payments">
          </div>
          <p class="why-text">Secure Payments</p>
        </div>
  
        <div class="why-item">
          <div class="why-logo">
            <img src="images/24-7services.avif" alt="24/7 Service">
          </div>
          <p class="why-text">24-7 Service</p>
        </div>
  
        <div class="why-item">
          <div class="why-logo">
            <img src="images/trustedseller.png" alt="Trusted Sellers">
          </div>
          <p class="why-text">Trusted Sellers</p>
        </div>
      </div>
    </div>
  </section>
  

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container">
      <p>All Rights Reserved By Safe Trade Hub</p>
    </div>
  </footer>


  <!-- External JavaScript Files -->
  <script src="js/app-state.js"></script>
  <script src="js/cart.js"></script>
  <script src="js/navigation.js"></script>

  <!-- Essential JavaScript Functions -->
  <script>
    // Toggle chatbot visibility
    function toggleChat() {
      const chatContainer = document.getElementById('chatbot-container');
      chatContainer.classList.toggle('show');
    }

    // Request notification permission and show notification
    function requestNotificationPermission() {
      if ('Notification' in window) {
        Notification.requestPermission().then(function (permission) {
          if (permission === 'granted') {
            new Notification('SafeTradeHub Notifications', {
              body: 'You will now receive notifications about your transactions!',
              icon: '/favicon.ico'
            });
          } else {
            alert('Notifications enabled! You\'ll receive updates about your orders and transactions.');
          }
        });
      } else {
        alert('Notifications enabled! You\'ll receive updates about your orders and transactions.');
      }
    }

    // Enhanced search functionality
    function performSearch(query) {
      if (!query || query.trim() === '') return;
      
      // Store search query
      localStorage.setItem('searchQuery', query.trim());
      
      // Redirect to search results
      window.location.href = `search-results.html?q=${encodeURIComponent(query.trim())}`;
    }

    // Initialize application on page load
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('ðŸš€ SafeTradeHub: Starting initialization...');
      
      try {
        // WAIT for AuthManager to be completely ready
        let authReady = false;
        let attempts = 0;
        while (!authReady && attempts < 50) {
          if (window.AuthManager) {
            try {
              await window.AuthManager.waitForInit();
              authReady = true;
              console.log('âœ… AuthManager ready after', attempts, 'attempts');
            } catch (error) {
              console.warn('âš ï¸ AuthManager not ready, attempt', attempts, error);
            }
          }
          if (!authReady) {
            await new Promise(resolve => setTimeout(resolve, 100));
            attempts++;
          }
        }
        
        // Force authentication check and header update
        if (window.AuthManager) {
          const isAuth = window.AuthManager.isAuthenticated();
          const user = window.AuthManager.getCurrentUser();
          console.log('ðŸ” Final auth state - authenticated:', isAuth, 'user:', user);
          
          // Force header update
          if (window.HeaderManager) {
            window.HeaderManager.updateHeaderState();
          }
        }
        
        // Update cart count if function exists
        if (typeof setBadge === 'function') {
          setBadge();
        }
        
        // Update cart count from cart.js
        if (typeof updateCartCount === 'function') {
          updateCartCount();
        }
        
        console.log('âœ… SafeTradeHub: Initialization complete');
      } catch (error) {
        console.error('âŒ SafeTradeHub: Initialization error:', error);
      }
      
      // Handle search form submission
      const searchForm = document.querySelector('.search');
      if (searchForm) {
        searchForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const searchInput = this.querySelector('input[type="search"]');
          if (searchInput) {
            performSearch(searchInput.value);
          }
        });
      }
      
      // Close chatbot when clicking outside
      document.addEventListener('click', function(e) {
        const chatContainer = document.getElementById('chatbot-container');
        const chatButton = e.target.closest('button[onclick="toggleChat()"]');
        
        if (!chatButton && !chatContainer.contains(e.target) && chatContainer.classList.contains('show')) {
          chatContainer.classList.remove('show');
        }
      });

      // Show welcome notification for new users
      if (!localStorage.getItem('welcomeShown')) {
        setTimeout(() => {
          if (typeof showNotification === 'function') {
            showNotification('Welcome to SafeTradeHub! ðŸŽ‰ Your secure marketplace with escrow protection.', 'success');
          }
          localStorage.setItem('welcomeShown', 'true');
        }, 2000);
      }
    });

    // Global notification system
    function showNotification(message, type = 'info') {
      // Remove existing notifications
      const existingNotifications = document.querySelectorAll('.notification');
      existingNotifications.forEach(notification => notification.remove());

      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.innerHTML = `
        <div class="notification-content">
          <span class="notification-message">${message}</span>
          <button class="notification-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
        </div>
      `;

      // Add to page
      document.body.appendChild(notification);

      // Show notification
      setTimeout(() => notification.classList.add('show'), 100);

      // Auto-hide after 5 seconds
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }

    // Make functions globally available
    window.showNotification = showNotification;
    window.performSearch = performSearch;
  </script>
  
  <!-- Include JavaScript modules -->
  <script src="js/app-state.js"></script>
  <script src="js/cart.js"></script>
  <script src="js/navigation.js"></script>

</body>
</html>
